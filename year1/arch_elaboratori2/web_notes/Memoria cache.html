<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2023-03-09_Memoria cache</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#memoria-cache">Memoria cache</a>
<ul>
<li><a href="#memorie-sram">Memorie SRAM</a></li>
<li><a href="#memorie-dram">Memorie DRAM</a></li>
<li><a href="#memoria-flash">Memoria flash</a></li>
<li><a href="#hard-disk">Hard disk</a></li>
<li><a href="#gerarchia-delle-memoria">Gerarchia delle memoria</a></li>
<li><a href="#cache-ad-accesso-diretto">Cache ad accesso diretto</a></li>
<li><a href="#conflitti">Conflitti</a></li>
<li><a href="#prestazioni">Prestazioni</a>
<ul>
<li></li>
</ul>
</li>
<li><a href="#cache-associative">Cache associative</a>
<ul>
<li></li>
<li><a href="#gestione-dei-miss-nelle-cache-associative">Gestione dei miss nelle cache associative</a></li>
<li><a href="#esempio-di-confronto-tra-tipi-cache">Esempio di confronto tra tipi cache</a></li>
</ul>
</li>
<li><a href="#cache-a-più-livelli">Cache a più livelli</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="memoria-cache">Memoria cache</h1>
<p>Nel mondo della tecnologia le memorie presentano dei limiti tecnici</p>
<ul>
<li>Le memoria lente sono capienti ed economiche</li>
<li>Le memorie veloci sono piccole e costose</li>
</ul>
<p>Esistono principalmente due tipologie di memorie: le SRAM e le DRAM</p>
<h2 id="memorie-sram">Memorie SRAM</h2>
<p>SRAM sta per Static Random Access Memory.</p>
<ul>
<li>Sono realizzate con molti componenti</li>
<li>Sono molto veloci</li>
<li>Sono relativamente grandi a livello di dimensioni</li>
<li>Consumano molta energia</li>
<li>Non hanno bisogno di un refresh periodico dei dati memorizzati</li>
</ul>
<p>Le memorie <strong>cache</strong> utilizzano questo di memoria</p>
<h2 id="memorie-dram">Memorie DRAM</h2>
<p>DRAM sta per Dynamic Random Access Memory.</p>
<ul>
<li>Sono realizzate con pochi componenti</li>
<li>Sono più lente delle SRAM</li>
<li>Occupano meno spazio</li>
<li>Consumano meno energia</li>
<li>Necessitano di un refresh periodico dei dati memorizzati (motivo per cui si chiamano Dynamic)</li>
</ul>
<p>Esistono altre versioni delle DRAM come le Syncrhonize DRAM (SDRAM) che utilizzano un clock sincronizzato con la CPU e le Double Data Rate SDRAM (DDR SDRAM) che possono trasferire dati sia sul fronte di salita sia su quello di discesa, raddoppiando la banda</p>
<p>Le classiche memorie RAM utilizzano questa tipologia di memoria</p>
<h2 id="memoria-flash">Memoria flash</h2>
<p>Un altro tipo di memoria sono le <strong>Memorie flash</strong> che sono di tipo EEPROM (Electrically Erasable Programmable Read Only Memory),</p>
<p>Una memoria flash molto utilizzata sono gli SSD (Solid state disk) i quali sono più lenti delle memoria DRAM però riescono a mantenere il dato anche se non alimentate, questo grazie alla tecnologia NAND flash.</p>
<p>Il problema principale di questi tipo di memoria è l’usura nel tempo. Per ridurre questo problema è presente un controller (wear leveling) che permette di distribuire le scritture dei dati in modo uniforme in tutto il disco, così che non si usurino maggiormente alcune parti rispetto ad altre.</p>
<p>Dato che il tempo di accesso è uguale in tutte le parti del disco, avere i dati sparsi a caso nel disco non rappresenta un problema di prestazioni. Per questo la deframmentazione (processo per il quale si cerca di mettere i dati relativi allo stesso file tutti molto vicini nelle celle del disco) è inutile e anzi riduce la vita dell’ssd.</p>
<h2 id="hard-disk">Hard disk</h2>
<p>Questo tipo di memoria sempre meno utilizzato a favore degli ssd sono:</p>
<ul>
<li>molto capienti</li>
<li>economici</li>
<li>è composto da dischi magnetici in movimento e una testina che ha il compito di scrivere e leggere i dati</li>
<li>decisamente più lento degli ssd</li>
<li>sensibile a vibrazioni</li>
</ul>
<p>In questo caso la deframmentazione ha senso dato che riordinare i dati aiuta la testina a leggere consecutivamente i dati che gli interessano migliorando le prestazioni.</p>
<h2 id="gerarchia-delle-memoria">Gerarchia delle memoria</h2>
<p>In un sistema completo vengono utilizzate tutte le tipologie di memoria, ognuna in un ambito diverso:</p>
<p>Le memorie più veloci vanno messe più vicine possibile al processore dato che i dati che cerca la CPU vengono cercate a cascata prima nelle memoria più veloci e poi, se il dato non viene trovato, cerca nelle altre memorie.</p>
<p>Le memorie più vicine alla CPU (chiamate memoria cache) contengono le copie di alcuni dati che si trovano nei livelli più lontani.<br>
Il livello più lontano di tutti contiene tutti dati.</p>
<h3 id="principio-di-località">Principio di località</h3>
<p>Il principio di località afferma che non tutte le parti del codice hanno la stessa probabilità di essere eseguite, alcune istruzioni vengono eseguite molto spesso e altre molto meno (pensa ai cicli per esempio)</p>
<ul>
<li><strong>Località temporale</strong> la località temporale dice che quando si fa riferimento ad un dato c’è la tendenza a fare riferimento allo stesso dato in breve tempo (istruzioni di un ciclo).</li>
<li><strong>Località spaziale</strong> la località spaziale dice che quando si fa riferimento ad un dato c’è la tendenza a fare riferimento ai dati adiacenti (scorrere gli array).</li>
</ul>
<h3 id="terminologia">Terminologia</h3>
<p>L’unità di informazione minima è detta <strong>blocco</strong> Quando il dato viene trovato nel livello di memoria si dice <strong>hit</strong> mentre se nel livello non si trova il dato si dice <strong>miss</strong>.</p>
<p>é possibile calcolare il rapporto tra gli accessi e la quantità di hit, lo stesso vale per i miss, questi vengono chiamati <strong>hit-rate</strong> <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mfrac><mtext>hit</mtext><mtext>accessi</mtext></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\frac{\text{hit}}{\text{accessi}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.22511em; vertical-align: -0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">accessi</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">hit</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span> e <strong>miss-rate</strong> <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mfrac><mtext>mis</mtext><mtext>accessi</mtext></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\frac{\text{mis}}{\text{accessi}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.2065em; vertical-align: -0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.861502em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">accessi</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">mis</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>Viene chiamato <strong>hit time</strong> il tempo impiegato per trovare il dato nella prima memoria in cui guarda il processore.<br>
Viene chiamato <strong>miss penalty</strong> il tempo necessario per trovare il dato nelle memoria inferiori + il tempo a passare tali dati alla CPU.</p>
<p>Le memorie cache sono delle memorie che nascono con lo scopo di aumentare l’hit-rate e minimizzare i tempi di accesso per i dati utilizzati più frequentemente.</p>
<h2 id="cache-ad-accesso-diretto">Cache ad accesso diretto</h2>
<p>Per progettare una cache bisogna decidere:</p>
<ul>
<li>La dimensione di un blocco e la quantità di blocchi da utilizzare</li>
<li>Come accedere/trovare/scrivere un blocco</li>
</ul>
<p>Bisogna creare una funzione che fa un <em>mappinig</em> tra gli indirizzi di memoria e i blocchi.</p>
<p>L’indice della memoria principale viene mappato con il relativo indice in memoria cache con formula:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>indice-blocco</mtext><mo>=</mo><mtext>indice-memoria</mtext> <mi mathvariant="normal">%</mi> <mtext>numero-blocchi</mtext></mrow><annotation encoding="application/x-tex">\text{indice-blocco} = \text{indice-memoria} \,\% \,\text{numero-blocchi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">indice-blocco</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord text"><span class="mord">indice-memoria</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">%</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">numero-blocchi</span></span></span></span></span></span></span></p>
<p>Per agevolare le operazioni il numero di blocchi è solitamente una potenza di 2, in questo modo l’operazione di modulo equivale a prendere i primi <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mo stretchy="false">(</mo><mtext>numero-blocchi</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log_2(\text{numero-blocchi})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">numero-blocchi</span></span><span class="mclose">)</span></span></span></span></span> dell’indirizzo (meno significativi).</p>
<p>Ad esempio<br>
considerando una cache grande 8 blocchi <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mn>2</mn><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(2^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> e prendendo come esempio l’indice di memoria: 01101</p>
<p>abbiamo che:<br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><msup><mn>2</mn><mn>3</mn></msup><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\log_2 2^3 = 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.05825em; vertical-align: -0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span></span></span></span></span><br>
Quindi l’indice del blocco associato al nostro indirizzo di memoria equivale ai primi 3 bit meno significativi dell’indirizzo, cioè 101.</p>
<p><img src="https://i.ibb.co/vZX90yC/cache.png" alt=""></p>
<p>Questo assumendo che la dimensione del blocco sia 1Byte, ma non è molto utile perché ad esempio le singole istruzioni sono lunghe 4 Byte e andare a copiare 1 byte alla volta sarebbe troppo dispendioso.</p>
<p>Ipotizzando di avere un blocco grande <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span></span></span></span></span> byte allora gli indirizzi consecutivi che differiscono di <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">n</span></span></span></span></span> bit finiranno nello stesso blocco.</p>
<p>Il mapping in questo caso si fa con:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>indice-blocco</mtext><mo>=</mo><mo stretchy="false">(</mo><mtext>indice-memoria</mtext> <mi mathvariant="normal">/</mi> <mtext>grandezza-blocco</mtext><mo stretchy="false">)</mo> <mi mathvariant="normal">%</mi> <mtext>numero-blocchi</mtext></mrow><annotation encoding="application/x-tex">\text{indice-blocco} = (\text{indice-memoria} \,/ \,\text{grandezza-blocco}) \,\% \,\text{numero-blocchi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">indice-blocco</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">indice-memoria</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">grandezza-blocco</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">%</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">numero-blocchi</span></span></span></span></span></span></span></p>
<p>ad esempio<br>
avendo 8 blocchi <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mn>2</mn><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(2^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span><br>
la dimensione di un blocco è 2<br>
come indice di memoria abbiamo: 01101</p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>indice-memoria</mtext> <mi mathvariant="normal">/</mi> <mtext>grandezza-blocco</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\text{indice-memoria} \,/ \,\text{grandezza-blocco})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">indice-memoria</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">grandezza-blocco</span></span><span class="mclose">)</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>01101</mn> <mi mathvariant="normal">/</mi> <mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(01101 \,/ \, 2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">01101</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span> equivale a fare uno shift di 1 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mn>2</mn><mo>=</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\log_22=1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> a destra</p>
<p>Quindi il nostro indirizzo diventa <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0110</mn></mrow><annotation encoding="application/x-tex">0110</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0110</span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>indice-memoria</mtext> <mi mathvariant="normal">/</mi> <mtext>grandezza-blocco</mtext><mo stretchy="false">)</mo> <mi mathvariant="normal">%</mi> <mtext>numero-blocchi</mtext></mrow><annotation encoding="application/x-tex">(\text{indice-memoria} \,/ \,\text{grandezza-blocco}) \,\% \,\text{numero-blocchi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">indice-memoria</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">grandezza-blocco</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">%</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">numero-blocchi</span></span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0110</mn> <mi mathvariant="normal">%</mi> <mn>8</mn></mrow><annotation encoding="application/x-tex">0110 \,\% \,8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0110</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">%</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">8</span></span></span></span></span> equivale a prendere in considerazione i primi 3 (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mn>8</mn></mrow><annotation encoding="application/x-tex">log_28</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">8</span></span></span></span></span>) bit meno significativi, quindi l’indice del blocco sarà <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>110</mn></mrow><annotation encoding="application/x-tex">110</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">110</span></span></span></span></span></p>
<p><img src="https://i.ibb.co/VNXSXBX/cache2.png" alt=""></p>
<p>Come si vede dall’immagine andando a ignorare l’ultimo bit otteniamo che ci sono due istruzioni che vanno contemporaneamente nello stesso blocco. I bit ignorati vengono chiamati <strong>offset</strong></p>
<h3 id="tag">Tag</h3>
<p>Dato che durante l’esecuzione del codice più istruzioni utilizzeranno gli stessi blocchi della cache, come faccio a riconoscere l’istruzione che c’è all’interno di un blocco in un determinato momento.</p>
<p>Per risolvere questo problema andiamo a <strong>memorizzare oltre al dato anche l’indice</strong> della memoria:</p>
<p>Nell’ultimo esempio fatto avevamo come indice 01101 che viene salvato assieme all’indice 01100. Quindi oltre ai dati contenuti in questi indici dovremmo salvarci anche gli indici stessi, ma in realtà basta salvarsi solo i bit più significativi (in questo caso ‘0’) perché i meno significativi (110*) rappresentano già l’indice del blocco della cache.</p>
<p>Questi bit più significativi vengono chiamati <strong>tag</strong></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>tag</mtext><mo>=</mo><mtext>indice-blocco</mtext><mi mathvariant="normal">/</mi><mtext>numero-blocchi</mtext></mrow><annotation encoding="application/x-tex">\text{tag} = \text{indice-blocco}/ \text{numero-blocchi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80952em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">tag</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">indice-blocco</span></span><span class="mord">/</span><span class="mord text"><span class="mord">numero-blocchi</span></span></span></span></span></span></span></p>
<h3 id="valid-bit">Valid bit</h3>
<p>Viene utilizzato un ulteriore bit per identificare se il dato attuale contenuto in un blocco della cache è valido oppure no. Appena acceso il PC tutti i valori nella cache non hanno significato e ci serve un bit per indicare che sono non significativi, cioè il <strong>valid bit</strong> che è inizializzato a 0.</p>
<ul>
<li>0: dati non validi</li>
<li>1: dati validi</li>
</ul>
<p>Man mano che la cache viene riempita, i valid bit dei blocchi passano da 0 a 1</p>
<h3 id="esempio-lettura-cache">Esempio lettura cache</h3>
<p><img src="https://i.ibb.co/w7x4D3J/read-cache.png" alt=""></p>
<ol>
<li>viene utilizzato l’index per trovare la riga corrispondente in cache</li>
<li>vengono confrontati i due tag e il risultato viene messo in <code>and</code> con il valid bit, questo per accertarsi che il dato sia valido e sia quello che effettivamente stiamo cercando</li>
<li>in base al byte offset otteniamo i dati che ci interessano</li>
</ol>
<h2 id="conflitti">Conflitti</h2>
<p>Quando dobbiamo portare un blocco in cache nella stessa posizione dove risiedono altri dati si causa un conflitto. Un conflitto si presenta quando due indirizzi hanno il campo INDEX uguale e il campo TAG diverso.</p>
<p>cosa ne facciamo di questi dati già presenti quando bisogna risolvere un conflitto?</p>
<ul>
<li>Se i quei dati dopo essere stati portati in cache sono stati solo letti, possiamo rimpiazzarli senza problemi (tanto in RAM ci sarà già una copia di essi)</li>
<li>Se quei dati dopo essere stati portati in cache sono stati modificati, prima di andare a rimpiazzarli dobbiamo aggiornare i dati anche ai livelli di memoria inferiori per mantenere una coerenza di dati. Occorre stabilire delle <strong>politiche di coerenza tra livelli di memoria</strong></li>
</ul>
<h3 id="politica-write-through">Politica write through</h3>
<p>In questa politica ogni scrittura in cache implica che la scrittura avvenga anche ai livelli di memoria inferiori.<br>
In questo caso abbiamo <strong>dati sempre coerenti</strong> però a <strong>livello prestazionale non è ottimale</strong>.</p>
<h3 id="politica-write-back">Politica write back</h3>
<p>In questa politica solo quando un dato in cache deve venire rimpiazzato allora viene prima scritto ai livelli di memoria sottostanti.<br>
In questo caso abbiamo <strong>ottime prestazioni nelle normali scritture</strong> però la <strong>sostituzione del blocco è più lenta del normale</strong></p>
<h3 id="cosa-accade-in-caso-di-miss-e-hit">Cosa accade in caso di miss e hit</h3>
<ul>
<li><strong>Read-hit</strong>: Avviene in caso di <code>lw</code> oppure <em>fetch</em> dell’istruzione e rappresenta l’accesso alla memoria con il massimo della velocità</li>
<li><strong>Read-miss</strong>: la CPU va messa in stallo finche la lettura non viene completata, quando il dato viene copiato il cache:
<ul>
<li>in caso di <em>fetch</em> viene ripetuto</li>
<li>in caso di <code>lw</code> viene completato l’accesso al dato</li>
</ul>
</li>
<li><strong>Write-hit</strong>: Avviene in caso di <code>sw</code>
<ul>
<li>Write through: i dati vengono scritti sia in cache sia in RAM</li>
<li>Write back: i dati vengono scritti soltanto in cache, viene segnalato che il blocco è stato modificato (attraverso un <em>dirty bit</em> associato al blocco)</li>
</ul>
</li>
<li><strong>Write-miss</strong>: Avviene in caso di <code>sw</code>
<ul>
<li>Write through: la CPU viene messa in stallo <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> il dato viene scritto direttamente in memoria RAM (senza passare per la cache).</li>
<li>Write back: la CPU viene messa in stallo <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> il blocco mancante in cache viene preso dalla memoria RAM e messo in cache <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> viene completata la <code>sw</code>.</li>
</ul>
</li>
</ul>
<h2 id="prestazioni">Prestazioni</h2>
<p>La misurazione delle prestazioni quando utilizziamo la memoria cache cambiano nel seguente modo:</p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>e</mi><mi>x</mi><mi>e</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mtext>cicli</mtext><mo>+</mo><mtext>cicli&nbsp;di&nbsp;stallo</mtext><mo stretchy="false">)</mo><mo>⋅</mo><mtext>periodo&nbsp;di&nbsp;clock</mtext></mrow><annotation encoding="application/x-tex">T_{exe} = (\text{cicli} + \text{cicli di stallo}) \cdot \text{periodo di clock}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">cicli</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">cicli&nbsp;di&nbsp;stallo</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">periodo&nbsp;di&nbsp;clock</span></span></span></span></span></span></p>
<p>Dove</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>cicli&nbsp;di&nbsp;stallo</mtext><mo>=</mo><mtext>IC</mtext><mo>⋅</mo><mtext>miss-ratio</mtext><mo>⋅</mo><mtext>miss-penalty</mtext></mrow><annotation encoding="application/x-tex">\text{cicli di stallo} = \text{IC} \cdot \text{miss-ratio} \cdot \text{miss-penalty}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">cicli&nbsp;di&nbsp;stallo</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">IC</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66786em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">miss-ratio</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">miss-penalty</span></span></span></span></span></span></span></p>
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>IC</mtext><mo>⋅</mo><mtext>miss-ratio</mtext><mo>:</mo></mrow><annotation encoding="application/x-tex">\text{IC} \cdot \text{miss-ratio}:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">IC</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66786em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">miss-ratio</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span>  rappresenta il numero di istruzioni che provocano il miss</li>
<li>per semplicità consideriamo un miss-penalty unico per scrittura e lettura</li>
<li>il <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>miss-ratio</mtext></mrow><annotation encoding="application/x-tex">\text{miss-ratio}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.66786em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">miss-ratio</span></span></span></span></span></span> si suddivide in <strong>instruction miss-ratio</strong> (per i miss dei fetch) e <strong>data miss-ratio</strong> (per i miss di <code>sw</code> e <code>lw</code>)</li>
</ul>
<p>Esempio:<br>
Assumiamo di avere un programma che ha:</p>
<ul>
<li>Instruction miss-ratio: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">2\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">2%</span></span></span></span></span> (2% riferito alle istruzioni totali)</li>
<li>Data miss-ratio: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">4\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">4%</span></span></span></span></span> (4% riferito alle istruzioni <code>sw</code>/<code>lw</code>)</li>
<li>Istruzioni <code>sw</code>/<code>lw</code>: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>36</mn><mi mathvariant="normal">%</mi><mo>⋅</mo><mi>I</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">36\% \cdot  IC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">36%</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span></span></span></span></span></li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>CPI</mtext><mtext>ideale</mtext></msub><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\text{CPI}_{\text{ideale}} = 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">CPI</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ideale</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span></span></span></span></span></li>
<li>miss-penalty: 40 cicli (quando si verifica un miss sono necessari 40 cicli di clock per recuperare il dato)</li>
</ul>
<h4 id="troviamo-i-cicli-di-stallo-per-le-istruzioni">Troviamo i cicli di stallo per le istruzioni:</h4>
<p>formula: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cicli&nbsp;di&nbsp;stallo</mtext><mo>=</mo><mtext>IC</mtext><mo>⋅</mo><mtext>instruction&nbsp;miss-ratio</mtext><mo>⋅</mo><mtext>miss-penalty</mtext></mrow><annotation encoding="application/x-tex">\text{cicli di stallo} = \text{IC} \cdot \text{instruction miss-ratio} \cdot \text{miss-penalty}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">cicli&nbsp;di&nbsp;stallo</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">IC</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66786em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">instruction&nbsp;miss-ratio</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">miss-penalty</span></span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>IC</mtext><mo>⋅</mo><mn>0.02</mn><mo>⋅</mo><mn>40</mn><mo>=</mo><mn>0.8</mn><mo>⋅</mo><mtext>IC</mtext></mrow><annotation encoding="application/x-tex">\text{IC} \cdot 0.02 \cdot 40 = 0.8 \cdot \text{IC}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">IC</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.02</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">40</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.8</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">IC</span></span></span></span></span></span></p>
<h4 id="troviamo-i-cicli-di-stallo-per-i-dati">Troviamo i cicli di stallo per i dati:</h4>
<p>formula: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cicli&nbsp;di&nbsp;stallo</mtext><mo>=</mo><msub><mtext>IC</mtext><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>i</mi></mrow></msub><mo>⋅</mo><mtext>data&nbsp;miss-ratio</mtext><mo>⋅</mo><mtext>miss-penalty</mtext></mrow><annotation encoding="application/x-tex">\text{cicli di stallo} = \text{IC}_{dati} \cdot \text{data miss-ratio} \cdot \text{miss-penalty}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">cicli&nbsp;di&nbsp;stallo</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">IC</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">data&nbsp;miss-ratio</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">miss-penalty</span></span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0.36</mn><mo>⋅</mo><mtext>IC</mtext><mo stretchy="false">)</mo><mo>⋅</mo><mn>0.04</mn><mo>⋅</mo><mn>40</mn><mo>=</mo><mn>0.58</mn><mo>⋅</mo><mtext>IC</mtext></mrow><annotation encoding="application/x-tex">(0.36\cdot \text{IC}) \cdot 0.04 \cdot 40 = 0.58 \cdot \text{IC}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">0.36</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">IC</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.04</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">40</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0.58</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">IC</span></span></span></span></span></span></p>
<h4 id="troviamo-i-cicli-di-stallo-totali">Troviamo i cicli di stallo totali</h4>
<p>sarà dato dalla somma dei due tipi di stalli:</p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.8</mn><mtext>IC</mtext><mo>+</mo><mn>0.58</mn><mtext>IC</mtext><mo>=</mo><mn>1.38</mn><mtext>IC</mtext></mrow><annotation encoding="application/x-tex">0.8 \text{IC} + 0.58 \text{IC} = 1.38\text{IC}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord">0.8</span><span class="mord text"><span class="mord">IC</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">0.58</span><span class="mord text"><span class="mord">IC</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">1.38</span><span class="mord text"><span class="mord">IC</span></span></span></span></span></span></p>
<h4 id="troviamo-i-cicli-di-stallo-medi-per-istruzione">Troviamo i cicli di stallo medi per istruzione</h4>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>1.38</mn><mtext>IC</mtext></mrow><mtext>IC</mtext></mfrac><mo>=</mo><mn>1.38</mn></mrow><annotation encoding="application/x-tex">\frac{1.38\text{IC}}{\text{IC}} = 1.38</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.21733em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">IC</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1.38</span><span class="mord text mtight"><span class="mord mtight">IC</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1.38</span></span></span></span></span></p>
<h4 id="troviamo-il-cpi-reale">Troviamo il CPI reale</h4>
<p>dato dalla somma tra  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>CPI</mtext><mrow><mi>i</mi><mi>d</mi><mi>e</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\text{CPI}_{ideale}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">CPI</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> e i cicli di stallo medi</p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>+</mo><mn>1.38</mn><mo>=</mo><mn>3.38</mn></mrow><annotation encoding="application/x-tex">2 + 1.38 = 3.38</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1.38</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3.38</span></span></span></span></span></p>
<h4 id="troviamo-lo-speedup">Troviamo lo speedup</h4>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>3.38</mn><mn>2</mn></mfrac><mo>=</mo><mn>1.69</mn></mrow><annotation encoding="application/x-tex">\frac{3.38}{2} = 1.69</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3.38</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1.69</span></span></span></span></span></p>
<p>Rispetto al nostro <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>CPI</mtext><mtext>ideale</mtext></msub></mrow><annotation encoding="application/x-tex">\text{CPI}_{\text{ideale}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">CPI</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ideale</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> , quello reale risulta essere 1.69 volte peggiore</p>
<h2 id="cache-associative">Cache associative</h2>
<p>Nella cache ad accesso diretto ogni blocco di memoria veniva associato ad un blocco di cache (tramite la funzione di mapping)</p>
<p>Nelle <strong>cache associative</strong> i blocchi vengono raggruppati in <strong>insiemi</strong> (set) e ogni insieme ha delle <strong>vie o blocchi</strong> (way), ogni via appartenente ad un insieme possiede il tag e il dato.</p>
<p>cache con 4 insiemi e due vie<br>
<img src="https://i.ibb.co/QvTc2VZ/cache-ass.png" alt="enter image description here"></p>
<p>In queste cache la funzione di mapping lavora solo sulla decisione degli insiemi mentre per decidere in quale via andare a salvare il dato viene scelto il primo posto libero che viene trovato.</p>
<p>Quindi ogni indirizzo in memoria avrò associato un relativo insieme in cache, e può andare in qualsiasi via in quel insieme.</p>
<p>In base alle esigenze è possibile decidere quanti insiemi e quanti vie utilizzare, ad esempio avendo un totale di 8 blocchi da gestire, posso organizzare la cache come nell’immagine:</p>
<p><img src="https://i.ibb.co/Khw0smN/caches.png" alt=""></p>
<p>Per andare a leggere un dato in cache ora sappiamo solo che un dato appartiene ad un determinato insieme, per trovare la posizione specifica bisogna scorrere tutto l’insieme. Nella <strong>cache completamente associativa</strong> ogni volta che ci serve un dato in cache bisogna scorrere tutta la cache (non molto efficiente)</p>
<p>Solitamente il numero di blocchi e il numero di insieme è un multiplo di 2.</p>
<h4 id="funzione-di-mapping">Funzione di mapping</h4>
<p>Ottengo l’insieme (set) della cache facendo:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>indice-blocco</mtext><mo>=</mo><mo stretchy="false">(</mo><mtext>indice-memoria</mtext> <mi mathvariant="normal">/</mi> <mtext>grandezza-blocco</mtext><mo stretchy="false">)</mo> <mi mathvariant="normal">%</mi> <mtext>numero-insiemi</mtext></mrow><annotation encoding="application/x-tex">\text{indice-blocco} = (\text{indice-memoria} \,/ \,\text{grandezza-blocco}) \,\% \,\text{numero-insiemi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">indice-blocco</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">indice-memoria</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">grandezza-blocco</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">%</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">numero-insiemi</span></span></span></span></span></span></span></p>
<p><img src="https://i.ibb.co/pnKtdSx/mapping.png" alt=""></p>
<p>Nel caso dell’immagine abbiamo 4 insiemi e 2 vie</p>
<p>dato che la dimensione del blocco è 2 allora per trovare l’indice del blocco dobbiamo prima ignorare 1 bit meno significativo <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mtext>dimensione_blocco</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\log_2\text{dimensione\_blocco})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">dimensione_blocco</span></span><span class="mclose">)</span></span></span></span></span> poi dobbiamo fare il modulo di quello che rimane per <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mtext>numero_insiemi</mtext></mrow><annotation encoding="application/x-tex">\log_2\text{numero\_insiemi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">numero_insiemi</span></span></span></span></span></span> , in questo caso 2. Fare l’operazione di modulo corrisponde a prendere i <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mtext>numero_insiemi</mtext></mrow><annotation encoding="application/x-tex">\log_2\text{numero\_insiemi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">numero_insiemi</span></span></span></span></span></span> bit meno significativi.</p>
<p>Ad esempio<br>
Prendendo in considerazione l’indice in memoria 01010</p>
<ul>
<li>ignoro il 1 bit meno significativo<br>
sarebbe l’operazione <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>indice-memoria</mtext> <mi mathvariant="normal">/</mi> <mtext>grandezza-blocco</mtext></mrow><annotation encoding="application/x-tex">\text{indice-memoria} \,/ \,\text{grandezza-blocco}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">indice-memoria</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">grandezza-blocco</span></span></span></span></span></span> che nel nostro caso è <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>01010</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">01010 / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">01010/2</span></span></span></span></span> che corrisponde ad uno shift a destra di <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mn>2</mn><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\log_22 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.93858em; vertical-align: -0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span><br>
mi rimane 0101</li>
<li>prendo i due bit meno significativi di quello che mi rimane<br>
sarebbe l’operazione <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>indice-memoria</mtext> <mi mathvariant="normal">/</mi> <mtext>grandezza-blocco</mtext><mo stretchy="false">)</mo> <mi mathvariant="normal">%</mi> <mtext>numero-insiemi</mtext></mrow><annotation encoding="application/x-tex">(\text{indice-memoria} \,/ \,\text{grandezza-blocco}) \,\% \,\text{numero-insiemi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">indice-memoria</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">grandezza-blocco</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">%</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">numero-insiemi</span></span></span></span></span></span><br>
che nel nostro caso è  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0101</mn><mi mathvariant="normal">%</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">0101 \% 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0101%4</span></span></span></span></span> che corrisponde a prendere i <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mn>4</mn><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\log_24 = 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.93858em; vertical-align: -0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">4</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span></span></span></span></span> bit meno significativi.<br>
Quindi l’indice in memoria cache di 01010 è 01</li>
</ul>
<h3 id="gestione-dei-miss-nelle-cache-associative">Gestione dei miss nelle cache associative</h3>
<p>Nel caso in cui si verifica un miss e tutte le vie di un insieme associato all’istruzione “missata” sono occupate bisogna decidere quale blocco andare a sostituire.</p>
<ul>
<li>Viene sostituito un blocco casuale</li>
<li>Viene sostituito il blocco usato meno di recente (Least recently used). Questa tecnica utilizza dei bit extra per memorizzare da quanto tempo non viene acceduto un blocco</li>
</ul>
<h3 id="esempio-di-confronto-tra-tipi-cache">Esempio di confronto tra tipi cache</h3>
<p>Compariamo: cache ad accesso diretto, cache associativa a 2 vie, cache completamente associativa.</p>
<p>tutte le cache composte da 4 blocchi<br>
ipotizziamo di avere i seguenti indirizzi a cui accedere (a cui abbiamo già tolto l’offset, quindi va solo fatto il modulo) [0,8,0,6,8]</p>
<h4 id="cache-ad-accesso-diretto-1">Cache ad accesso diretto</h4>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>indirizzo</mtext><mi mathvariant="normal">%</mi><mtext>numero-blocchi</mtext></mrow><annotation encoding="application/x-tex">\text{indirizzo} \% \text{numero-blocchi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord text"><span class="mord">indirizzo</span></span><span class="mord">%</span><span class="mord text"><span class="mord">numero-blocchi</span></span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mi mathvariant="normal">%</mi><mn>4</mn><mo>=</mo><mn>0</mn><mspace width="0.8535826771653543em"></mspace><mn>8</mn><mi mathvariant="normal">%</mi><mn>4</mn><mo>=</mo><mn>0</mn><mspace width="0.8535826771653543em"></mspace><mn>0</mn><mi mathvariant="normal">%</mi><mn>4</mn><mo>=</mo><mn>0</mn><mspace width="0.8535826771653543em"></mspace><mn>6</mn><mi mathvariant="normal">%</mi><mn>4</mn><mo>=</mo><mn>2</mn><mspace width="0.8535826771653543em"></mspace><mn>8</mn><mi mathvariant="normal">%</mi><mn>4</mn><mo>=</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0\%4=0\hspace{3mm} 8\%4=0 \hspace{3mm} 0\%4=0 \hspace{3mm}6\%4=2 \hspace{3mm} 8\%4=0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0%4</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">8%4</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">0%4</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">6%4</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">8%4</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></p>
<p>In questo caso abbiamo che tutti gli indirizzi di memoria sono mappati per andare all’indice di cache 0 tranne l’indirizzo 6</p>
<p><img src="https://i.ibb.co/LQtqDRn/cache-diretta.png" alt=""></p>
<p>Otteniamo tutti <em>miss</em></p>
<ul>
<li>1° riga: prima apparizione del dato 0 quindi sicuramente non è presente in cache <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 0 in cache nel blocco 0</li>
<li>2° riga: prima apparizione del dato 8 quindi sicuramente non è presente in cache <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 8 in cache nel blocco 0 (il dato precedente viene perso)</li>
<li>3° riga: viene cercato il dato 0 ma non è presente nella sua posizione <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> miss e inserimento del dato 0 in cache nel blocco 0 (il dato precedente viene perso)</li>
<li>4° riga: prima apparizione del dato 6 quindi sicuramente non è presente in cache <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 6 in cache nel blocco 2</li>
<li>5° riga: viene cercato il dato 8 ma non è presente nella sua posizione <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> miss e inserimento del dato 8 in cache nel blocco 0 (il dato precedente viene perso)</li>
</ul>
<h4 id="cache-associativa-a-2-vie">Cache associativa a 2 vie</h4>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>indirizzo</mtext><mi mathvariant="normal">%</mi><mtext>numero-insiemi</mtext></mrow><annotation encoding="application/x-tex">\text{indirizzo} \% \text{numero-insiemi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord text"><span class="mord">indirizzo</span></span><span class="mord">%</span><span class="mord text"><span class="mord">numero-insiemi</span></span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mi mathvariant="normal">%</mi><mn>2</mn><mo>=</mo><mn>0</mn><mspace width="0.8535826771653543em"></mspace><mn>8</mn><mi mathvariant="normal">%</mi><mn>2</mn><mo>=</mo><mn>0</mn><mspace width="0.8535826771653543em"></mspace><mn>0</mn><mi mathvariant="normal">%</mi><mn>2</mn><mo>=</mo><mn>0</mn><mspace width="0.8535826771653543em"></mspace><mn>6</mn><mi mathvariant="normal">%</mi><mn>2</mn><mo>=</mo><mn>0</mn><mspace width="0.8535826771653543em"></mspace><mn>8</mn><mi mathvariant="normal">%</mi><mn>2</mn><mo>=</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0\%2=0\hspace{3mm} 8\%2=0 \hspace{3mm} 0\%2=0 \hspace{3mm}6\%2=0 \hspace{3mm} 8\%2=0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0%2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">8%2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">0%2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">6%2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.80556em; vertical-align: -0.05556em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.853583em;"></span><span class="mord">8%2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></p>
<p>In questo caso abbiamo che tutti gli indirizzi di memoria sono mappati per andare all’insieme della cache 0</p>
<p><img src="https://i.ibb.co/9y5n3v0/2way.png" alt=""></p>
<ul>
<li>1° riga: prima apparizione del dato 0 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 0 in cache nell’insieme 0 nella prima posizione libera</li>
<li>2° riga: prima apparizione del dato 8  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 8 in cache nell’insieme 0 nella prima posizione libera</li>
<li>3° riga: viene cercato il dato 0 e viene trovato <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>hit</em></li>
<li>4° riga: prima apparizione del dato 6 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 6 al posto del dato utilizzato meno di recente (cioè 8, perché 0 è stato letto nell’accesso precedente)</li>
<li>5° riga: viene cercato il dato 8 ma non è presente nel suo insieme<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> miss e inserimento del dato 8 al posto del dato utilizzato meno di recente (cioè 0)</li>
</ul>
<h4 id="cache-completamente-associativa">Cache completamente associativa</h4>
<p>i dati vanno nel primo blocco che trovano libero</p>
<p><img src="https://i.ibb.co/pnDVRhR/compl-ass.png" alt=""></p>
<ul>
<li>1° riga: prima apparizione del dato 0 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 0 in cache nella prima posizione libera</li>
<li>2° riga: prima apparizione del dato 8  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 8 in cache nella prima posizione libera</li>
<li>3° riga: viene cercato il dato 0 e viene trovato <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>hit</em></li>
<li>4° riga: prima apparizione del dato 6 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>miss</em> e inserimento del dato 6 nella prima posizione libera</li>
<li>5° riga: viene cercato il dato 8 e viene trovato <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <em>hit</em></li>
</ul>
<h2 id="cache-a-più-livelli">Cache a più livelli</h2>
<p>Nei processori moderni esistono 3 livelli di memoria cache che si differenziano per dimensione, velocità e posizionamento relativo al processore:</p>
<ul>
<li>L1: la più veloce, la più vicina alla CPU (una per ogni core della CPU), la più piccola</li>
<li>L2: meno veloce di L1, più lontana alla CPU rispetto a L1 (singola condivisa da ogni core della CPU), più grande di L1</li>
<li>L3  La meno veloce, la più lontana alla CPU rispetto le altre due (singola condivisa da ogni core della CPU), più grande rispetto alle altre 2</li>
</ul>
<p>Tutti e tre i livelli sono comunque notevolmente più veloci della memoria RAM</p>

    </div>
  </div>
</body>

</html>
